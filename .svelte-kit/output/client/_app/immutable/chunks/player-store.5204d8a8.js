import{f as T}from"./fixture-store.6d59531b.js";import{s as j}from"./system-store.bc0743d8.js";import{w as D}from"./index.8caf67b2.js";import"./toast-store.ddf69d4c.js";import{A as L,k as W,r as x}from"./team-store.38ee0fd3.js";function w(){const{subscribe:h,set:N}=D([]);let P;j.subscribe(e=>{P=e});let f;T.subscribe(e=>f=e);let I=L.createActor(W,"pec6o-uqaaa-aaaal-qb7eq-cai");async function y(){let e="players",a=(await I.getDataHashes()).find(n=>n.category===e)??null;const r=localStorage.getItem(e);if(a?.hash!=r){let n=await I.getAllPlayers();localStorage.setItem("players_data",JSON.stringify(n,x)),localStorage.setItem(e,a?.hash??""),N(n)}else{const n=localStorage.getItem("players_data");let o=[];try{o=JSON.parse(n||"[]")}catch{o=[]}N(o)}}async function u(){const e=localStorage.getItem("player_events_data");let s;try{s=JSON.parse(e||"[]")}catch{s=[]}return s}async function A(e,s){try{return await I.getPlayerDetails(e,s)}catch(a){throw console.error("Error fetching player data:",a),a}}async function C(e,s){let a=[];P?.focusGameweek===s?a=await u():a=await I.getPlayersDetailsForGameweek(e.playerIds,P?.activeSeason.id,s);const n=(await Promise.all(a.map(async o=>await F(o)))).map(o=>{const i=O(o,f),l=R(o,e,i),p=o.player.id===e.captainId?i+l:0;return{...o,points:i,bonusPoints:l,totalPoints:i+l+p}});return await Promise.all(n)}async function F(e){let s=0,a=0,r=0,n=0,o=0,i=0,l=0,p=0,_=0,d=0,v=0,S=0,t=0,c=0,E=0,g=0;e.events.forEach(b=>{switch(b.eventType){case 0:v+=1;break;case 1:switch(s+=1,e.position){case 0:case 1:t+=20;break;case 2:t+=15;break;case 3:t+=10;break}break;case 2:switch(a+=1,e.position){case 0:case 1:c+=15;break;case 2:case 3:c+=10;break}break;case 3:d+=1,e.position<2&&d%2===0&&(E+=-15);break;case 4:l+=1;break;case 5:p+=1,e.position<2&&d===0&&(g+=10);break;case 6:_+=1;break;case 7:o+=1;break;case 8:n+=1;break;case 9:r+=1;break;case 10:i+=1;break;case 11:S+=1;break}});let m=[];return h(b=>m=b),{player:m.find(b=>b.id===e.id),points:e.points,appearance:v,goals:s,assists:a,goalsConceded:d,saves:l,cleanSheets:p,penaltySaves:_,missedPenalties:o,yellowCards:n,redCards:r,ownGoals:i,highestScoringPlayerId:S,goalPoints:t,assistPoints:c,goalsConcededPoints:E,cleanSheetPoints:g,gameweek:e.gameweek,bonusPoints:0,totalPoints:0}}function O(e,s){if(!e)return console.error("No gameweek data found:",e),0;let a=0,r=5,n=5,o=20,i=25,l=-20,p=-10,_=-15,d=-10,v=-5,S=10;var t=0,c=0;switch(e.appearance>0&&(a+=r*e.appearance),e.redCards>0&&(a+=l),e.missedPenalties>0&&(a+=p*e.missedPenalties),e.ownGoals>0&&(a+=d*e.ownGoals),e.yellowCards>0&&(a+=v*e.yellowCards),e.player.position){case 0:t=20,c=15,e.saves>=3&&(a+=Math.floor(e.saves/3)*n),e.penaltySaves&&(a+=o*e.penaltySaves),e.cleanSheets>0&&(a+=S),e.goalsConceded>=2&&(a+=Math.floor(e.goalsConceded/2)*_);break;case 1:t=20,c=15,e.cleanSheets>0&&(a+=S),e.goalsConceded>=2&&(a+=Math.floor(e.goalsConceded/2)*_);break;case 2:t=15,c=10;break;case 3:t=10,c=10;break}return(s?s.filter(m=>m.gameweek===e.gameweek):[]).find(m=>(m.homeTeamId===e.player.teamId||m.awayTeamId===e.player.teamId)&&m.highestScoringPlayerId===e.player.id)&&(a+=i),a+=e.goals*t,a+=e.assists*c,a}function R(e,s,a){if(!e)return console.error("No gameweek data found:",e),0;let r=0;var n=0,o=0;switch(e.player.position){case 0:n=20,o=15;break;case 1:n=20,o=15;break;case 2:n=15,o=10;break;case 3:n=10,o=10;break}return s.goalGetterGameweek===e.gameweek&&s.goalGetterPlayerId===e.player.id&&(r=e.goals*n*2),s.passMasterGameweek===e.gameweek&&s.passMasterPlayerId===e.player.id&&(r=e.assists*o*2),s.noEntryGameweek===e.gameweek&&s.noEntryPlayerId===e.player.id&&(e.player.position===0||e.player.position===1)&&e.cleanSheets&&(r=a*2),s.safeHandsGameweek===e.gameweek&&e.player.position===0&&e.saves>=5&&(r=a*2),s.captainFantasticGameweek===e.gameweek&&s.captainId===e.player.id&&e.goals>0&&(r=a),s.braceBonusGameweek===e.gameweek&&e.goals>=2&&(r=a),s.hatTrickHeroGameweek===e.gameweek&&e.goals>=3&&(r=a*2),s.teamBoostGameweek===e.gameweek&&e.player.teamId===s.teamBoostTeamId&&(r=a),r}return{subscribe:h,sync:y,getPlayerDetails:A,getGameweekPlayers:C}}const H=w();export{H as p};
